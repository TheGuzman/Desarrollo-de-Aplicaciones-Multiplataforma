/* Ejercicio 05 */

/************************************************************
	Ejecutar el script en el orden en que aparecen las 
	sentencias para evitar errores de creación de tablas, 
	borrado de datos, entre otros
************************************************************/


CREATE DATABASE IF NOT EXISTS Banco 
CHARACTER SET utf8 
COLLATE utf8_general_ci;

USE Banco;

CREATE TABLE IF NOT EXISTS Cliente (
	Dni CHAR(10) PRIMARY KEY,
    Nombre VARCHAR(100) NOT NULL UNIQUE,
    Apellidos VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS Sucursal (
	Numero CHAR(30) PRIMARY KEY,
    Ciudad CHAR(100) NOT NULL,
    Activo_actual DOUBLE NOT NULL
);

CREATE TABLE IF NOT EXISTS Cuenta (
	Numero CHAR(30),
    Num_sucursal CHAR(30),
	Saldo DOUBLE NOT NULL,
    
    PRIMARY KEY(Numero, Num_sucursal),
    CONSTRAINT Fk_numSucursal FOREIGN KEY (Num_sucursal) REFERENCES Sucursal(Numero)
);

CREATE TABLE IF NOT EXISTS Transaccion (
	Numero INT PRIMARY KEY,
    Fecha DATE NOT NULL,
    Tipo CHAR(3) NOT NULL CHECK (Tipo IN ('Ing', 'Ext')),
    Cantidad DOUBLE,
    Num_cuenta CHAR(30) NOT NULL,
    
    CONSTRAINT Fk_cuenta FOREIGN KEY (Num_cuenta) REFERENCES Cuenta (Numero)
);

/* Tabla inecesaria */
CREATE TABLE IF NOT EXISTS Asistencia (
	Dni_cliente CHAR(10),
    Num_sucursal CHAR(30),
    
    PRIMARY KEY (Dni_cliente, Num_sucursal),
    CONSTRAINT Fk_Asistencia1 FOREIGN KEY (Dni_cliente) REFERENCES Cliente (Dni),
    CONSTRAINT Fk_Asistencia2 FOREIGN KEY (Num_sucursal) REFERENCES Sucursal (Numero)
);

CREATE TABLE IF NOT EXISTS Propiedad (
	Dni_cliente CHAR(10),
    Num_cuenta CHAR(30),
    Num_sucursal CHAR(30),
    
    PRIMARY KEY (Dni_cliente, Num_cuenta, Num_sucursal),
    CONSTRAINT Fk_Propiedad1 FOREIGN KEY (Dni_cliente) REFERENCES Cliente (Dni),
    CONSTRAINT Fk_Propiedad2 FOREIGN KEY (Num_cuenta) REFERENCES Cuenta (Numero),
    CONSTRAINT Fk_Propiedad3 FOREIGN KEY (Num_sucursal) REFERENCES Sucursal (Numero)
);

CREATE TABLE IF NOT EXISTS Direccion (
	Dni_cliente CHAR(10),
    Calle CHAR(100),
    Codigo_postal INT,
    Ciudad CHAR(45),
    Pais CHAR(45),
    
    PRIMARY KEY (Dni_cliente, Calle, Codigo_postal, Ciudad, Pais),
    CONSTRAINT Fk_Direccion FOREIGN KEY (Dni_cliente) REFERENCES Cliente (Dni)
);

/* Consultas*/
SELECT * FROM Cliente;
SELECT * FROM Sucursal;
SELECT * FROM Direccion;
SELECT * FROM Propiedad;
SELECT * FROM Asistencia;
SELECT * FROM Transaccion;
SELECT * FROM Cuenta;

/* Inserts en tabla Cliente */
INSERT INTO Cliente VALUES('12345679-K', 'Raúl', 'García');
INSERT INTO Cliente VALUES('87355679-F', 'Jos', 'Pablo');
INSERT INTO Cliente VALUES('29861338-T', 'María', 'Gisbert');
INSERT INTO Cliente VALUES('19746836-W', 'Roberto', 'Torres');
INSERT INTO Cliente VALUES('89374827-E', 'José', 'María');
INSERT INTO Cliente VALUES('87478261-W', 'Juan', 'Antonio');
INSERT INTO Cliente VALUES('20589673-R', 'Albert', 'Gisbert');
INSERT INTO Cliente VALUES('89374692-Y', 'Ferrán', 'Giménez');
INSERT INTO Cliente VALUES('20383792-P', 'Roberto', 'Carlos');
INSERT INTO Cliente VALUES('19374613-N', 'Cynthia', 'Cirilla');

/* Inserts en tabla Sucursal */
INSERT INTO Sucursal VALUES('123456789009876543211874563923', 'Madrid', 1500000.5);
INSERT INTO Sucursal VALUES('223356772009874726211374663221', 'Barcelona', 3500000.5);

/* Inserts en tabla Cuenta */
INSERT INTO Cuenta VALUES('000000000000000000000000038263', '223356772009874726211374663221', 157333.5);
INSERT INTO Cuenta VALUES('000000000000000000000000026451', '223356772009874726211374663221', 365712.5);
INSERT INTO Cuenta VALUES('000000000000000000000000037580', '123456789009876543211874563923', 274671.5);
INSERT INTO Cuenta VALUES('000000000000000000000000037461', '123456789009876543211874563923', 847892.3);
INSERT INTO Cuenta VALUES('000000000000000000000000035791', '223356772009874726211374663221', 365478.5);
INSERT INTO Cuenta VALUES('000000000000000000000000058371', '223356772009874726211374663221', 386822.4);
INSERT INTO Cuenta VALUES('000000000000000000000000097823', '123456789009876543211874563923', 333333.2);
INSERT INTO Cuenta VALUES('000000000000000000000000048759', '223356772009874726211374663221', 384792.5);
INSERT INTO Cuenta VALUES('000000000000000000000000083622', '123456789009876543211874563923', 948724.3);
INSERT INTO Cuenta VALUES('000000000000000000000000048723', '123456789009876543211874563923', 286748.1);

/* Inserts en tabla Transaccion */
INSERT INTO Transaccion VALUES();

/* Inserts en tabla Propiedad */
INSERT INTO Propiedad VALUES('12345679-K', '000000000000000000000000038263', '223356772009874726211374663221');
INSERT INTO Propiedad VALUES('87355679-F', '000000000000000000000000026451', '223356772009874726211374663221');
INSERT INTO Propiedad VALUES('29861338-T', '000000000000000000000000037580', '123456789009876543211874563923');
INSERT INTO Propiedad VALUES('19746836-W', '000000000000000000000000037461', '123456789009876543211874563923');
INSERT INTO Propiedad VALUES('89374827-E', '000000000000000000000000035791', '223356772009874726211374663221');
INSERT INTO Propiedad VALUES('87478261-W', '000000000000000000000000058371', '223356772009874726211374663221');
INSERT INTO Propiedad VALUES('20589673-R', '000000000000000000000000097823', '123456789009876543211874563923');
INSERT INTO Propiedad VALUES('89374692-Y', '000000000000000000000000048759', '223356772009874726211374663221');
INSERT INTO Propiedad VALUES('20383792-P', '000000000000000000000000083622', '123456789009876543211874563923');
INSERT INTO Propiedad VALUES('19374613-N', '000000000000000000000000048723', '123456789009876543211874563923');

/* Inserts en tabla Direccion */
INSERT INTO Direccion VALUES();

/* Limpieza */
TRUNCATE Direccion;
TRUNCATE Propiedad;
TRUNCATE Asistencia;
TRUNCATE Transaccion;
TRUNCATE Cuenta;
TRUNCATE Sucursal;
TRUNCATE Cliente;

DROP TABLE Direccion;
DROP TABLE Propiedad;
DROP TABLE Asistencia;
DROP TABLE Transaccion;
DROP TABLE Cuenta;
DROP TABLE Sucursal;
DROP TABLE Cliente;

DROP DATABASE Banco;